language: c
before_install:
  - |
    # Test the master branch with Nim master and other branches with Nim devel
    if [ "$TRAVIS_BRANCH" = master ]; then
        export branch=master
    else
        export branch=devel
    fi
install:
  - |
    git clone -b $branch --depth 1 git://github.com/nim-lang/nim nim-$branch/
    cd nim-$branch
    git clone -b $branch --depth 1 git://github.com/nim-lang/csources csources/
    cd csources
    sh build.sh
    cd ..
    rm -rf csources
    bin/nim c koch
    ./koch boot -d:release
    cd ..
    git clone https://github.com/nim-lang/nimble.git
    cd nimble
    git clone -b v0.13.0 --depth 1 https://github.com/nim-lang/nim vendor/nim
    nim-$branch/bin c -r src/nimble install
    cd ..
before_script:
  - export PATH="nim-$branch/bin:$PATH"
  - nimble install
script: nim c --run ./tests/test.nim

cache:
  directories:
    - nim-master
    - nim-devel

branches:
  except:
    - gh-pages